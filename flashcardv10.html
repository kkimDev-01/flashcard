<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2a2a2a">
  <title>ë‹¨ì–´ì¥</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif; transition: background-color 0.3s, color 0.3s; }
    body.light { background-color: #f5f5f5; color: #333; }
    body.dark { background-color: #1a1a1a; color: #e0e0e0; }
    
    /* Header - Fixed */
    .header { position: fixed; top: 0; left: 0; right: 0; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 100; }
    body.light .header { background-color: #fff; border-bottom: 1px solid #e0e0e0; }
    body.dark .header { background-color: #2a2a2a; border-bottom: 1px solid #444; }
    .hamburger { width: 30px; height: 30px; cursor: pointer; display: flex; flex-direction: column; justify-content: space-around; padding: 5px 0; }
    .hamburger span { display: block; height: 3px; background-color: currentColor; border-radius: 2px; }
    .book-selector { flex: 1; margin: 0 15px; padding: 8px 12px; border: 1px solid; border-radius: 8px; font-size: 16px; }
    body.light .book-selector { background-color: #f9f9f9; border-color: #ddd; color: #333; }
    body.dark .book-selector { background-color: #333; border-color: #555; color: #e0e0e0; }
    .theme-toggle { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; font-size: 20px; }
    body.light .theme-toggle { background-color: #333; color: #fff; }
    body.dark .theme-toggle { background-color: #fff; color: #333; }
    
    /* Sidebar */
    .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100vh; z-index: 200; transition: left 0.3s; padding: 20px; overflow-y: auto; }
    body.light .sidebar { background-color: #fff; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
    body.dark .sidebar { background-color: #2a2a2a; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
    .sidebar.open { left: 0; }
    .sidebar-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 150; display: none; }
    .sidebar-overlay.show { display: block; }
    .sidebar-item { padding: 15px 10px; margin: 5px 0; cursor: pointer; border-radius: 8px; }
    body.light .sidebar-item:hover { background-color: #f0f0f0; }
    body.dark .sidebar-item:hover { background-color: #3a3a3a; }
    
    /* Main Container - Scrollable */
    .container { padding-top: 60px; min-height: 100vh; }
    
    /* Card Title - Fixed below header */
    .card-title { position: sticky; top: 60px; padding: 20px; font-size: 18px; font-weight: 500; text-align: center; border-bottom: 1px solid; z-index: 90; }
    body.light .card-title { background-color: #fff; border-color: #e0e0e0; }
    body.dark .card-title { background-color: #2a2a2a; border-color: #444; }
    .card-title.back-side { background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.05)); border-bottom-color: #ffd700; }
    body.dark .card-title.back-side { background: linear-gradient(135deg, rgba(255,215,0,0.25), rgba(255,215,0,0.1)); }
    .card-counter { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 14px; opacity: 0.7; }
    
    /* Card Content - Scrollable */
    .card-content { padding: 30px 20px; font-size: 16px; line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; max-width: 800px; margin: 0 auto; }
    .card-content.editing { padding: 15px; }
    .edit-textarea { width: 100%; min-height: 300px; padding: 15px; border: 2px solid #ffd700; border-radius: 8px; font-size: 16px; line-height: 1.8; resize: vertical; font-family: inherit; }
    body.light .edit-textarea { background-color: #fffef5; color: #333; }
    body.dark .edit-textarea { background-color: #2a2a14; color: #e0e0e0; }
    .edit-buttons { display: flex; gap: 10px; padding: 15px; justify-content: center; border-top: 2px solid #ffd700; }
    .edit-btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; }
    .edit-btn.save { background-color: #4caf50; color: #fff; }
    .edit-btn.cancel { background-color: #f44336; color: #fff; }
    
    /* Card Footer - Fixed at bottom */
    .card-footer { position: fixed; bottom: 0; left: 0; right: 0; display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; border-top: 1px solid; z-index: 90; }
    body.light .card-footer { background-color: #fff; border-color: #e0e0e0; }
    body.dark .card-footer { background-color: #2a2a2a; border-color: #444; }
    .week-status { font-size: 14px; font-weight: 500; padding: 4px 8px; border-radius: 4px; }
    .week-status.read { color: #4caf50; background-color: rgba(76, 175, 80, 0.1); }
    .week-status.unread { color: #f44336; background-color: rgba(244, 67, 54, 0.1); }
    .action-buttons { display: flex; gap: 15px; }
    .action-btn { width: 40px; height: 40px; border: 2px solid transparent; border-radius: 50%; cursor: pointer; font-size: 20px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
    body.light .action-btn { background-color: #f5f5f5; color: #666; }
    body.dark .action-btn { background-color: #3a3a3a; color: #aaa; }
    .action-btn:active { transform: scale(0.95); }
    .action-btn.active { background-color: #ff9800; color: #fff; border-color: #ff9800; }
    .action-btn.has-comment { background-color: #2196f3; color: #fff; border-color: #2196f3; }
    .action-btn.has-bookmark { background-color: #ffd700; color: #333; border-color: #ffd700; }
    
    /* Edit Button */
    .edit-icon-btn { position: fixed; right: 20px; bottom: 90px; width: 50px; height: 50px; border-radius: 50%; background-color: #ffd700; color: #333; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(255,215,0,0.4); z-index: 95; }
    .edit-icon-btn:active { transform: scale(0.95); }
    
    /* Flip Indicator */
    .flip-indicator { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); font-size: 14px; opacity: 0.5; z-index: 85; cursor: pointer; padding: 10px; }
    
    /* Bottom Padding for Footer */
    .content-wrapper { padding-bottom: 80px; }
    
    /* Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 300; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5); }
    .modal.show { display: flex; }
    .modal-content { width: 90%; max-width: 500px; max-height: 80vh; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
    body.light .modal-content { background-color: #fff; }
    body.dark .modal-content { background-color: #2a2a2a; }
    .modal-header { padding: 20px; font-size: 18px; font-weight: 500; border-bottom: 1px solid; }
    body.light .modal-header { border-color: #e0e0e0; }
    body.dark .modal-header { border-color: #444; }
    .modal-body { flex: 1; padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
    .modal-footer { padding: 15px 20px; display: flex; gap: 10px; justify-content: flex-end; border-top: 1px solid; }
    body.light .modal-footer { border-color: #e0e0e0; }
    body.dark .modal-footer { border-color: #444; }
    .modal-btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; }
    .modal-btn.primary { background-color: #2196f3; color: #fff; }
    body.light .modal-btn.secondary { background-color: #f5f5f5; color: #666; }
    body.dark .modal-btn.secondary { background-color: #3a3a3a; color: #aaa; }
    
    textarea { width: 100%; min-height: 100px; padding: 12px; border: 1px solid; border-radius: 8px; font-size: 14px; resize: vertical; font-family: inherit; }
    body.light textarea { background-color: #f9f9f9; border-color: #ddd; color: #333; }
    body.dark textarea { background-color: #333; border-color: #555; color: #e0e0e0; }
    .comment-item { padding: 12px; margin: 8px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: flex-start; }
    body.light .comment-item { background-color: #f9f9f9; }
    body.dark .comment-item { background-color: #333; }
    .comment-text { flex: 1; white-space: pre-wrap; line-height: 1.5; }
    .delete-btn { padding: 5px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin-left: 10px; background-color: #f44336; color: #fff; }
    .stats-table { width: 100%; border-collapse: collapse; }
    .stats-table th, .stats-table td { padding: 12px; text-align: left; border-bottom: 1px solid; }
    body.light .stats-table th, body.light .stats-table td { border-color: #e0e0e0; }
    body.dark .stats-table th, body.dark .stats-table td { border-color: #444; }
    .loading { text-align: center; padding: 40px; font-size: 18px; }
    input[type="text"], input[type="file"] { width: 100%; padding: 10px 12px; border: 1px solid; border-radius: 8px; font-size: 14px; margin: 10px 0; }
    body.light input[type="text"], body.light input[type="file"] { background-color: #f9f9f9; border-color: #ddd; color: #333; }
    body.dark input[type="text"], body.dark input[type="file"] { background-color: #333; border-color: #555; color: #e0e0e0; }
    .checkbox-item { padding: 10px; margin: 5px 0; display: flex; align-items: center; gap: 10px; cursor: pointer; border-radius: 6px; }
    .no-data { text-align: center; padding: 40px; color: #999; }
    .page-container { padding: 20px 20px 100px 20px; margin-top: 60px; }
    .import-section { margin: 20px 0; }
    .import-label { display: block; margin: 15px 0 5px; font-weight: 500; }
  </style>
</head>
<body class="dark">
  <div class="header">
    <div class="hamburger" onclick="toggleSidebar()"><span></span><span></span><span></span></div>
    <select class="book-selector" id="bookSelector" onchange="onBookFilterChange()"><option value="">ì „ì²´</option></select>
    <button class="theme-toggle" onclick="toggleTheme()">â˜€ï¸</button>
  </div>
  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
  <div class="sidebar">
    <div class="sidebar-item" onclick="goToMode('all')">ì „ì²´ ë‹¨ì–´ì¥</div>
    <div class="sidebar-item" onclick="goToMode('unread_today')">ì˜¤ëŠ˜ ì½ì§€ ì•Šì€ ë‹¨ì–´ì¥</div>
    <div class="sidebar-item" onclick="goToMode('unread_week')">ì´ë²ˆì£¼ ì½ì§€ ì•Šì€ ë‹¨ì–´ì¥</div>
    <div class="sidebar-item" onclick="goToMode('bookmark')">ë¶ë§ˆí¬</div>
    <div class="sidebar-item" onclick="goToMode('stats')">í†µê³„</div>
    <div class="sidebar-item" onclick="exportLocalStorage()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</div>
    <div class="sidebar-item" onclick="importLocalStorage()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</div>
    <div class="sidebar-item" onclick="showImportPage()">Content/Book ê°€ì ¸ì˜¤ê¸°</div>
  </div>
  <div class="container" id="mainContainer"><div class="loading">ë¡œë”© ì¤‘...</div></div>
  
  <div class="modal" id="commentModal">
    <div class="modal-content">
      <div class="modal-header">ì½”ë©˜íŠ¸</div>
      <div class="modal-body">
        <div id="commentList"></div>
        <textarea id="newComment" placeholder="ìƒˆ ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" onclick="closeCommentModal()">ë‹«ê¸°</button>
        <button class="modal-btn primary" onclick="addComment()">ì¶”ê°€</button>
      </div>
    </div>
  </div>
  
  <div class="modal" id="bookmarkModal">
    <div class="modal-content">
      <div class="modal-header">ë¶ë§ˆí¬ ê·¸ë£¹</div>
      <div class="modal-body">
        <div id="bookmarkGroupList"></div>
        <input type="text" id="newBookmarkGroup" placeholder="ìƒˆ ê·¸ë£¹ ì´ë¦„">
        <button class="modal-btn primary" onclick="addNewBookmarkGroup()" style="width:100%;margin-top:10px">ê·¸ë£¹ ì¶”ê°€</button>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" onclick="closeBookmarkModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

<script>
const BOOKS = [
  { id: 'genesis', name: 'ì°½ì„¸ê¸°' },
  { id: 'exodus', name: 'ì¶œì• êµ½ê¸°' },
  { id: 'leviticus', name: 'ë ˆìœ„ê¸°' },
  { id: 'numbers', name: 'ë¯¼ìˆ˜ê¸°' },
  { id: 'deuteronomy', name: 'ì‹ ëª…ê¸°' }
];

let CONTENTS = [
  {
    book: 'genesis',
    chapter: 1,
    verse: 1,
    text: 'íƒœì´ˆì— í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹œë‹ˆë¼',
    appendix: 'íˆë¸Œë¦¬ì–´ ì›ë¬¸: ×‘Ö°Ö¼×¨Öµ××©Ö´××™×ª ×‘Ö¸Ö¼×¨Ö¸× ×Ö±×œÖ¹×”Ö´×™× ×Öµ×ª ×”Ö·×©Ö¸Ö¼××Ö·×™Ö´× ×•Ö°×Öµ×ª ×”Ö¸×Ö¸×¨Ö¶×¥\n\nì´ êµ¬ì ˆì€ ì„±ê²½ì˜ ì²« êµ¬ì ˆë¡œ, í•˜ë‚˜ë‹˜ì˜ ì°½ì¡° ì‚¬ì—­ì˜ ì‹œì‘ì„ ì„ í¬í•©ë‹ˆë‹¤. "ë² ë ˆì‰¬íŠ¸(×‘Ö°Ö¼×¨Öµ××©Ö´××™×ª)"ëŠ” "ì²˜ìŒì—" ë˜ëŠ” "íƒœì´ˆì—"ë¥¼ ì˜ë¯¸í•˜ë©°, "ë°”ë¼(×‘Ö¸Ö¼×¨Ö¸×)"ëŠ” ë¬´ì—ì„œ ìœ ë¥¼ ì°½ì¡°í•˜ëŠ” í•˜ë‚˜ë‹˜ë§Œì˜ ê³ ìœ í•œ ì°½ì¡° í–‰ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.'
  },
  {
    book: 'genesis',
    chapter: 1,
    verse: 2,
    text: 'ë•…ì´ í˜¼ëˆí•˜ê³  ê³µí—ˆí•˜ë©° í‘ì•”ì´ ê¹ŠìŒ ìœ„ì— ìˆê³  í•˜ë‚˜ë‹˜ì˜ ì˜ì€ ìˆ˜ë©´ ìœ„ì— ìš´í–‰í•˜ì‹œë‹ˆë¼',
    appendix: 'í˜¼ëˆ(×ªÖ¹×”×•Ö¼)ê³¼ ê³µí—ˆ(×‘Ö¹×”×•Ö¼)ëŠ” ì§ˆì„œê°€ ì—†ê³  ìƒëª…ì´ ì—†ëŠ” ìƒíƒœë¥¼ ë¬˜ì‚¬í•©ë‹ˆë‹¤.\ní•˜ë‚˜ë‹˜ì˜ ì˜(×¨×•Ö¼×—Ö· ×Ö±×œÖ¹×”Ö´×™×)ì´ ìˆ˜ë©´ ìœ„ë¥¼ ìš´í–‰í•˜ì‹¬ì€ ì°½ì¡° ì‚¬ì—­ì„ ì¤€ë¹„í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜ì˜ ì„ì¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.'
  },
  {
    book: 'genesis',
    chapter: 1,
    verse: 3,
    text: 'í•˜ë‚˜ë‹˜ì´ ì´ë¥´ì‹œë˜ ë¹›ì´ ìˆìœ¼ë¼ í•˜ì‹œë‹ˆ ë¹›ì´ ìˆì—ˆê³ ',
    appendix: 'í•˜ë‚˜ë‹˜ì˜ ì²« ë²ˆì§¸ ì°½ì¡° ëª…ë ¹ì…ë‹ˆë‹¤. ë§ì”€ìœ¼ë¡œ ì°½ì¡°í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜ì˜ ëŠ¥ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.\n\nì´ ë¹›ì€ íƒœì–‘ì´ ì°½ì¡°ë˜ê¸° ì „ì˜ ë¹›ìœ¼ë¡œ(íƒœì–‘ì€ 4ì¼ì§¸ ì°½ì¡°ë¨), í•˜ë‚˜ë‹˜ ìì‹ ì˜ ì˜ê´‘ì˜ ë¹›ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
  },
  {
    book: 'genesis',
    chapter: 1,
    verse: 4,
    text: 'ë¹›ì´ í•˜ë‚˜ë‹˜ì´ ë³´ì‹œê¸°ì— ì¢‹ì•˜ë”ë¼ í•˜ë‚˜ë‹˜ì´ ë¹›ê³¼ ì–´ë‘ ì„ ë‚˜ëˆ„ì‚¬',
    appendix: '"ë³´ì‹œê¸°ì— ì¢‹ì•˜ë”ë¼(×˜×•Ö¹×‘)"ëŠ” ì°½ì¡°ì˜ ì™„ì „í•¨ê³¼ ëª©ì  ë‹¬ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” í‘œí˜„ì…ë‹ˆë‹¤.\n\në¹›ê³¼ ì–´ë‘ ì˜ ë¶„ë¦¬ëŠ” ì§ˆì„œ ìˆëŠ” ì°½ì¡°ì˜ ì‹œì‘ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.'
  },
  {
    book: 'genesis',
    chapter: 1,
    verse: 5,
    text: 'í•˜ë‚˜ë‹˜ì´ ë¹›ì„ ë‚®ì´ë¼ ë¶€ë¥´ì‹œê³  ì–´ë‘ ì„ ë°¤ì´ë¼ ë¶€ë¥´ì‹œë‹ˆë¼ ì €ë…ì´ ë˜ê³  ì•„ì¹¨ì´ ë˜ë‹ˆ ì´ëŠ” ì²«ì§¸ ë‚ ì´ë‹ˆë¼',
    appendix: 'í•˜ë‚˜ë‹˜ê»˜ì„œ ì´ë¦„ì„ ì§€ìœ¼ì‹¬ìœ¼ë¡œ ê¶Œìœ„ë¥¼ í–‰ì‚¬í•˜ì‹­ë‹ˆë‹¤.\n\níˆë¸Œë¦¬ì‹ ì‹œê°„ ê³„ì‚°ë²•: ì €ë…ë¶€í„° ì•„ì¹¨ê¹Œì§€ê°€ í•˜ë£¨ì…ë‹ˆë‹¤.\nì²«ì§¸ ë‚ (×™×•Ö¹× ×Ö¶×—Ö¸×“) - ì°½ì¡° ì£¼ê°„ì˜ ì‹œì‘'
  },
  {
    book: 'exodus',
    chapter: 20,
    verse: 1,
    text: 'í•˜ë‚˜ë‹˜ì´ ì´ ëª¨ë“  ë§ì”€ìœ¼ë¡œ ë§ì”€í•˜ì—¬ ì´ë¥´ì‹œë˜',
    appendix: 'ì‹­ê³„ëª…ì˜ ì„œë¡ ì…ë‹ˆë‹¤. ì‹œë‚´ì‚°ì—ì„œ í•˜ë‚˜ë‹˜ê»˜ì„œ ì§ì ‘ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ì—ê²Œ ì£¼ì‹  ìœ¨ë²•ì…ë‹ˆë‹¤.'
  },
  {
    book: 'exodus',
    chapter: 20,
    verse: 2,
    text: 'ë‚˜ëŠ” ë„ˆë¥¼ ì• êµ½ ë•…, ì¢… ë˜ì—ˆë˜ ì§‘ì—ì„œ ì¸ë„í•˜ì—¬ ë‚¸ ë„¤ í•˜ë‚˜ë‹˜ ì—¬í˜¸ì™€ë‹ˆë¼',
    appendix: 'ì‹­ê³„ëª…ì˜ ì „ì œ: í•˜ë‚˜ë‹˜ì˜ êµ¬ì› í–‰ìœ„\n\ní•˜ë‚˜ë‹˜ê»˜ì„œëŠ” ìœ¨ë²•ì„ ì£¼ì‹œê¸° ì „ì— ë¨¼ì € ìì‹ ì„ êµ¬ì›ìë¡œ ì†Œê°œí•˜ì‹­ë‹ˆë‹¤. ì´ê²ƒì€ ì€í˜œê°€ ìœ¨ë²•ì— ì„ í–‰í•¨ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.'
  },
  {
    book: 'exodus',
    chapter: 20,
    verse: 3,
    text: 'ë„ˆëŠ” ë‚˜ ì™¸ì—ëŠ” ë‹¤ë¥¸ ì‹ ë“¤ì„ ë„¤ê²Œ ë‘ì§€ ë§ë¼',
    appendix: 'ì œ1ê³„ëª…: ìœ ì¼ì‹  ì‹ ì•™\n\níˆë¸Œë¦¬ì–´ ì§ì—­: "ë‚´ ë©´ì „ì— ë‹¤ë¥¸ ì‹ ë“¤ì´ ì—†ì–´ì•¼ í•œë‹¤"\nì´ê²ƒì€ ëª¨ë“  ê³„ëª…ì˜ ê¸°ì´ˆê°€ ë˜ëŠ” ê·¼ë³¸ ì›ë¦¬ì…ë‹ˆë‹¤.'
  },
  {
    book: 'leviticus',
    chapter: 19,
    verse: 18,
    text: 'ì›ìˆ˜ë¥¼ ê°šì§€ ë§ë©° ë™í¬ë¥¼ ì›ë§í•˜ì§€ ë§ë©° ë„¤ ì´ì›ƒ ì‚¬ë‘í•˜ê¸°ë¥¼ ë„¤ ìì‹ ê³¼ ê°™ì´ ì‚¬ë‘í•˜ë¼ ë‚˜ëŠ” ì—¬í˜¸ì™€ë‹ˆë¼',
    appendix: 'ì˜ˆìˆ˜ë‹˜ê»˜ì„œ ê°€ì¥ í° ê³„ëª… ì¤‘ í•˜ë‚˜ë¡œ ì¸ìš©í•˜ì‹  êµ¬ì ˆì…ë‹ˆë‹¤(ë§ˆ 22:39).\n\n"ë„¤ ì´ì›ƒì„ ë„¤ ëª¸ê³¼ ê°™ì´ ì‚¬ë‘í•˜ë¼"ëŠ” ëª¨ë“  ìœ¨ë²•ì˜ í•µì‹¬ì…ë‹ˆë‹¤.'
  },
  {
    book: 'numbers',
    chapter: 6,
    verse: 24,
    text: 'ì—¬í˜¸ì™€ëŠ” ë„¤ê²Œ ë³µì„ ì£¼ì‹œê³  ë„ˆë¥¼ ì§€í‚¤ì‹œê¸°ë¥¼ ì›í•˜ë©°',
    appendix: 'ì•„ë¡ ì˜ ì¶•ë³µ(ë¯¼ 6:24-26)ì˜ ì²« ë²ˆì§¸ ë¶€ë¶„ì…ë‹ˆë‹¤.\n\nì´ ì¶•ë³µì€ ì˜¤ëŠ˜ë‚ ê¹Œì§€ ìœ ëŒ€êµì™€ ê¸°ë…êµì—ì„œ ì‚¬ìš©ë˜ëŠ” ê°€ì¥ ì˜¤ë˜ëœ ì¶•ë„ë¬¸ì…ë‹ˆë‹¤.'
  },
  {
    book: 'deuteronomy',
    chapter: 6,
    verse: 4,
    text: 'ì´ìŠ¤ë¼ì—˜ì•„ ë“¤ìœ¼ë¼ ìš°ë¦¬ í•˜ë‚˜ë‹˜ ì—¬í˜¸ì™€ëŠ” ì˜¤ì§ ìœ ì¼í•œ ì—¬í˜¸ì™€ì´ì‹œë‹ˆ',
    appendix: 'ì‰ë§ˆ(×©Ö°××Ö·×¢)ë¡œ ì•Œë ¤ì§„ ìœ ëŒ€êµì˜ ê°€ì¥ ì¤‘ìš”í•œ ì‹ ì•™ê³ ë°±ì…ë‹ˆë‹¤.\n\níˆë¸Œë¦¬ì–´: ×©Ö°××Ö·×¢ ×™Ö´×©Ö°×‚×¨Ö¸×Öµ×œ ×™Ö°×”×•Ö¸×” ×Ö±×œÖ¹×”Öµ×™× ×•Ö¼ ×™Ö°×”×•Ö¸×” ×Ö¶×—Ö¸×“\n(ì‰ë§ˆ ì´ìŠ¤ë¼ì—˜ ì•„ë„ë‚˜ì´ ì—˜ë¡œí—¤ì´ëˆ„ ì•„ë„ë‚˜ì´ ì—í•˜ë“œ)\n\nê²½ê±´í•œ ìœ ëŒ€ì¸ë“¤ì€ í•˜ë£¨ì— ë‘ ë²ˆ ì´ êµ¬ì ˆì„ ì•”ì†¡í•©ë‹ˆë‹¤.'
  },
  {
    book: 'deuteronomy',
    chapter: 6,
    verse: 5,
    text: 'ë„ˆëŠ” ë§ˆìŒì„ ë‹¤í•˜ê³  ëœ»ì„ ë‹¤í•˜ê³  í˜ì„ ë‹¤í•˜ì—¬ ë„¤ í•˜ë‚˜ë‹˜ ì—¬í˜¸ì™€ë¥¼ ì‚¬ë‘í•˜ë¼',
    appendix: 'ì˜ˆìˆ˜ë‹˜ê»˜ì„œ ê°€ì¥ í° ê³„ëª…ìœ¼ë¡œ ì¸ìš©í•˜ì‹  êµ¬ì ˆì…ë‹ˆë‹¤(ë§ˆ 22:37).\n\nì „ì¸ê²©ì  ì‚¬ë‘: ë§ˆìŒ(ê°ì •), ëœ»(ì˜ì§€), í˜(ëŠ¥ë ¥) ëª¨ë‘ë¥¼ ë‹¤í•´ í•˜ë‚˜ë‹˜ì„ ì‚¬ë‘í•´ì•¼ í•©ë‹ˆë‹¤.'
  }
];
let currentIndex = 0;
let currentMode = 'all';
let currentBookFilter = '';
let currentBookmarkGroup = null;
let filteredContents = [];
let currentContent = null;
let isFlipped = false;
let isEditingAppendix = false;

const storage = {
  getKey: (book, chapter, verse) => `${book}_${chapter}_${verse}`,
  
  saveAppendix: (book, chapter, verse, text) => {
    localStorage.setItem(`appendix_${storage.getKey(book, chapter, verse)}`, text);
  },
  
  getAppendix: (book, chapter, verse) => {
    return localStorage.getItem(`appendix_${storage.getKey(book, chapter, verse)}`);
  },
  
  addComment: (book, chapter, verse, comment) => {
    const key = `comments_${storage.getKey(book, chapter, verse)}`;
    const comments = JSON.parse(localStorage.getItem(key) || '[]');
    comments.push({ text: comment, timestamp: Date.now() });
    localStorage.setItem(key, JSON.stringify(comments));
  },
  
  getComments: (book, chapter, verse) => {
    const key = `comments_${storage.getKey(book, chapter, verse)}`;
    return JSON.parse(localStorage.getItem(key) || '[]');
  },
  
  deleteComment: (book, chapter, verse, index) => {
    const key = `comments_${storage.getKey(book, chapter, verse)}`;
    const comments = JSON.parse(localStorage.getItem(key) || '[]');
    comments.splice(index, 1);
    localStorage.setItem(key, JSON.stringify(comments));
  },
  
  addBookmark: (group, book, chapter, verse) => {
    const key = `bookmark_${group}`;
    const bookmarks = JSON.parse(localStorage.getItem(key) || '[]');
    const bookmark = storage.getKey(book, chapter, verse);
    if (!bookmarks.includes(bookmark)) {
      bookmarks.push(bookmark);
      localStorage.setItem(key, JSON.stringify(bookmarks));
    }
  },
  
  removeBookmark: (group, book, chapter, verse) => {
    const key = `bookmark_${group}`;
    const bookmarks = JSON.parse(localStorage.getItem(key) || '[]');
    const bookmark = storage.getKey(book, chapter, verse);
    const index = bookmarks.indexOf(bookmark);
    if (index > -1) {
      bookmarks.splice(index, 1);
      localStorage.setItem(key, JSON.stringify(bookmarks));
    }
  },
  
  getBookmarkGroups: () => {
    const groups = [];
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      if (key.startsWith('bookmark_')) {
        groups.push(key.replace('bookmark_', ''));
      }
    }
    return groups;
  },
  
  getBookmarks: (group) => {
    const key = `bookmark_${group}`;
    return JSON.parse(localStorage.getItem(key) || '[]');
  },
  
  isBookmarked: (book, chapter, verse) => {
    const groups = storage.getBookmarkGroups();
    const bookmark = storage.getKey(book, chapter, verse);
    return groups.some(group => storage.getBookmarks(group).includes(bookmark));
  },
  
  getBookmarkGroupsForVerse: (book, chapter, verse) => {
    const groups = storage.getBookmarkGroups();
    const bookmark = storage.getKey(book, chapter, verse);
    return groups.filter(group => storage.getBookmarks(group).includes(bookmark));
  },
  
  toggleRead: (book, chapter, verse) => {
    const key = `read_${storage.getKey(book, chapter, verse)}`;
    const now = new Date().toISOString();
    if (localStorage.getItem(key)) {
      localStorage.removeItem(key);
    } else {
      localStorage.setItem(key, now);
    }
  },
  
  isReadToday: (book, chapter, verse) => {
    const key = `read_${storage.getKey(book, chapter, verse)}`;
    const readTime = localStorage.getItem(key);
    if (!readTime) return false;
    const readDate = new Date(readTime);
    const today = new Date();
    return readDate.toDateString() === today.toDateString();
  },
  
  isReadThisWeek: (book, chapter, verse) => {
    const key = `read_${storage.getKey(book, chapter, verse)}`;
    const readTime = localStorage.getItem(key);
    if (!readTime) return false;
    const readDate = new Date(readTime);
    const now = new Date();
    const dayOfWeek = now.getDay();
    const monday = new Date(now);
    monday.setDate(now.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
    monday.setHours(0, 0, 0, 0);
    return readDate >= monday;
  }
};

function loadContents() {
  filteredContents = CONTENTS.filter(c => {
    if (currentBookFilter && c.book !== currentBookFilter) return false;
    
    if (currentMode === 'unread_today') {
      return !storage.isReadToday(c.book, c.chapter, c.verse);
    } else if (currentMode === 'unread_week') {
      return !storage.isReadThisWeek(c.book, c.chapter, c.verse);
    } else if (currentMode === 'bookmark' && currentBookmarkGroup) {
      const bookmarks = storage.getBookmarks(currentBookmarkGroup);
      return bookmarks.includes(storage.getKey(c.book, c.chapter, c.verse));
    }
    return true;
  });
  
  if (filteredContents.length === 0) {
    document.getElementById('mainContainer').innerHTML = '<div class="no-data">í‘œì‹œí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  
  if (currentIndex >= filteredContents.length) currentIndex = 0;
  showCard();
}

function showCard() {
  currentContent = filteredContents[currentIndex];
  isFlipped = false;
  isEditingAppendix = false;
  
  const bookName = BOOKS.find(b => b.id === currentContent.book)?.name || currentContent.book;
  const counter = `${currentIndex + 1} / ${filteredContents.length}`;
  
  const frontTitle = `${bookName} ${currentContent.chapter}:${currentContent.verse}`;
  const frontContent = currentContent.text;
  
  const savedAppendix = storage.getAppendix(currentContent.book, currentContent.chapter, currentContent.verse);
  const appendixText = savedAppendix || currentContent.appendix || 'ë¶€ë¡ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤';
  
  const isRead = storage.isReadThisWeek(currentContent.book, currentContent.chapter, currentContent.verse);
  const readStatus = isRead ? '<span class="week-status read">ì½ìŒ</span>' : '<span class="week-status unread">ì•ˆì½ìŒ</span>';
  
  const hasComments = storage.getComments(currentContent.book, currentContent.chapter, currentContent.verse).length > 0;
  const isBookmarked = storage.isBookmarked(currentContent.book, currentContent.chapter, currentContent.verse);
  
  const commentBtnClass = hasComments ? 'action-btn has-comment' : 'action-btn';
  const bookmarkBtnClass = isBookmarked ? 'action-btn has-bookmark' : 'action-btn';
  const readBtnClass = isRead ? 'action-btn active' : 'action-btn';
  
  const html = `
    <div class="content-wrapper">
      <div class="card-title" id="cardTitle">
        ${frontTitle}
        <span class="card-counter">${counter}</span>
      </div>
      <div class="card-content" id="cardContent">
        ${frontContent}
      </div>
    </div>
    <div class="flip-indicator" onclick="flipCard()">â†» ë’¤ì§‘ê¸°</div>
    <button class="edit-icon-btn" id="editBtn" onclick="startEditingAppendix()" style="display:none">âœ</button>
    <div class="card-footer">
      <div>${readStatus}</div>
      <div class="action-buttons">
        <button class="${commentBtnClass}" onclick="openCommentModal()">ğŸ’¬</button>
        <button class="${bookmarkBtnClass}" onclick="openBookmarkModal()">â­</button>
        <button class="${readBtnClass}" onclick="toggleRead()">âœ“</button>
      </div>
    </div>
  `;
  
  document.getElementById('mainContainer').innerHTML = html;
  setupSwipe();
}

function flipCard() {
  if (isEditingAppendix) return;
  
  const titleEl = document.getElementById('cardTitle');
  const contentEl = document.getElementById('cardContent');
  const editBtn = document.getElementById('editBtn');
  
  isFlipped = !isFlipped;
  
  if (isFlipped) {
    // Show back side
    const bookName = BOOKS.find(b => b.id === currentContent.book)?.name || currentContent.book;
    const counter = `${currentIndex + 1} / ${filteredContents.length}`;
    titleEl.className = 'card-title back-side';
    titleEl.innerHTML = `ë¶€ë¡: ${bookName} ${currentContent.chapter}:${currentContent.verse}<span class="card-counter">${counter}</span>`;
    
    const savedAppendix = storage.getAppendix(currentContent.book, currentContent.chapter, currentContent.verse);
    const appendixText = savedAppendix || currentContent.appendix || 'ë¶€ë¡ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤';
    contentEl.textContent = appendixText;
    editBtn.style.display = 'block';
  } else {
    // Show front side
    const bookName = BOOKS.find(b => b.id === currentContent.book)?.name || currentContent.book;
    const counter = `${currentIndex + 1} / ${filteredContents.length}`;
    titleEl.className = 'card-title';
    titleEl.innerHTML = `${bookName} ${currentContent.chapter}:${currentContent.verse}<span class="card-counter">${counter}</span>`;
    contentEl.textContent = currentContent.text;
    editBtn.style.display = 'none';
  }
  
  window.scrollTo(0, 0);
}

function startEditingAppendix() {
  isEditingAppendix = true;
  const contentEl = document.getElementById('cardContent');
  const savedAppendix = storage.getAppendix(currentContent.book, currentContent.chapter, currentContent.verse);
  const appendixText = savedAppendix || currentContent.appendix || '';
  
  contentEl.className = 'card-content editing';
  contentEl.innerHTML = `
    <textarea class="edit-textarea" id="editTextarea">${appendixText}</textarea>
    <div class="edit-buttons">
      <button class="edit-btn cancel" onclick="cancelEditingAppendix()">ì·¨ì†Œ</button>
      <button class="edit-btn save" onclick="saveAppendix()">ì €ì¥</button>
    </div>
  `;
  
  document.getElementById('editBtn').style.display = 'none';
}

function cancelEditingAppendix() {
  isEditingAppendix = false;
  flipCard();
  setTimeout(() => flipCard(), 10);
}

function saveAppendix() {
  const newText = document.getElementById('editTextarea').value;
  storage.saveAppendix(currentContent.book, currentContent.chapter, currentContent.verse, newText);
  isEditingAppendix = false;
  
  const contentEl = document.getElementById('cardContent');
  contentEl.className = 'card-content';
  contentEl.textContent = newText || 'ë¶€ë¡ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤';
  
  document.getElementById('editBtn').style.display = 'block';
}

function setupSwipe() {
  let startX = 0, startY = 0;
  
  document.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
  });
  
  document.addEventListener('touchend', (e) => {
    const endX = e.changedTouches[0].clientX;
    const endY = e.changedTouches[0].clientY;
    const diffX = endX - startX;
    const diffY = endY - startY;
    
    // Only trigger swipe if horizontal movement is greater than vertical
    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
      if (diffX > 0) prevCard();
      else nextCard();
    }
  });
}

function nextCard() {
  if (isEditingAppendix) return;
  if (currentIndex < filteredContents.length - 1) {
    currentIndex++;
    showCard();
    window.scrollTo(0, 0);
  }
}

function prevCard() {
  if (isEditingAppendix) return;
  if (currentIndex > 0) {
    currentIndex--;
    showCard();
    window.scrollTo(0, 0);
  }
}

function openCommentModal() {
  const comments = storage.getComments(currentContent.book, currentContent.chapter, currentContent.verse);
  const commentList = document.getElementById('commentList');
  
  if (comments.length === 0) {
    commentList.innerHTML = '<div style="color:#999;text-align:center;padding:20px">ì½”ë©˜íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
  } else {
    commentList.innerHTML = comments.map((c, i) => `
      <div class="comment-item">
        <div class="comment-text">${c.text}</div>
        <button class="delete-btn" onclick="deleteComment(${i})">ì‚­ì œ</button>
      </div>
    `).join('');
  }
  
  document.getElementById('newComment').value = '';
  document.getElementById('commentModal').classList.add('show');
}

function closeCommentModal() {
  document.getElementById('commentModal').classList.remove('show');
}

function addComment() {
  const commentText = document.getElementById('newComment').value.trim();
  if (!commentText) {
    alert('ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
    return;
  }
  storage.addComment(currentContent.book, currentContent.chapter, currentContent.verse, commentText);
  openCommentModal();
  showCard();
}

function deleteComment(index) {
  if (confirm('ì´ ì½”ë©˜íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    storage.deleteComment(currentContent.book, currentContent.chapter, currentContent.verse, index);
    openCommentModal();
    showCard();
  }
}

function openBookmarkModal() {
  const groups = storage.getBookmarkGroups();
  const currentGroups = storage.getBookmarkGroupsForVerse(currentContent.book, currentContent.chapter, currentContent.verse);
  const groupList = document.getElementById('bookmarkGroupList');
  
  if (groups.length === 0) {
    groupList.innerHTML = '<div style="color:#999;text-align:center;padding:20px">ë“±ë¡ëœ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤</div>';
  } else {
    groupList.innerHTML = groups.map(group => {
      const isChecked = currentGroups.includes(group);
      return `
        <div class="checkbox-item">
          <input type="checkbox" id="group_${group}" ${isChecked ? 'checked' : ''} onchange="toggleBookmarkGroup('${group}', this.checked)">
          <label for="group_${group}" style="flex:1">${group}</label>
        </div>
      `;
    }).join('');
  }
  
  document.getElementById('bookmarkModal').classList.add('show');
}

function closeBookmarkModal() {
  document.getElementById('bookmarkModal').classList.remove('show');
  document.getElementById('newBookmarkGroup').value = '';
}

function addNewBookmarkGroup() {
  const groupName = document.getElementById('newBookmarkGroup').value.trim();
  if (!groupName) {
    alert('ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
    return;
  }
  storage.addBookmark(groupName, currentContent.book, currentContent.chapter, currentContent.verse);
  document.getElementById('newBookmarkGroup').value = '';
  openBookmarkModal();
  showCard();
}

function toggleBookmarkGroup(group, checked) {
  if (checked) {
    storage.addBookmark(group, currentContent.book, currentContent.chapter, currentContent.verse);
  } else {
    storage.removeBookmark(group, currentContent.book, currentContent.chapter, currentContent.verse);
  }
  showCard();
}

function toggleRead() {
  storage.toggleRead(currentContent.book, currentContent.chapter, currentContent.verse);
  showCard();
}

function toggleTheme() {
  const body = document.body;
  const btn = document.querySelector('.theme-toggle');
  if (body.classList.contains('light')) {
    body.classList.remove('light');
    body.classList.add('dark');
    btn.textContent = 'â˜€ï¸';
  } else {
    body.classList.remove('dark');
    body.classList.add('light');
    btn.textContent = 'ğŸŒ™';
  }
}

function toggleSidebar() {
  document.querySelector('.sidebar').classList.toggle('open');
  document.querySelector('.sidebar-overlay').classList.toggle('show');
}

function goToMode(mode) {
  toggleSidebar();
  currentMode = mode;
  currentIndex = 0;
  if (mode === 'bookmark') {
    showBookmarkList();
  } else if (mode === 'stats') {
    showStats();
  } else {
    loadContents();
  }
}

function showBookmarkList() {
  const groups = storage.getBookmarkGroups();
  if (groups.length === 0) {
    document.getElementById('mainContainer').innerHTML = '<div class="no-data">ë“±ë¡ëœ ë¶ë§ˆí¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  let html = '<div class="page-container"><h2 style="margin-bottom:20px">ë¶ë§ˆí¬ ê·¸ë£¹ ì„ íƒ</h2>';
  groups.forEach(group => {
    html += `<div class="sidebar-item" onclick="selectBookmarkGroup('${group}')">${group}</div>`;
  });
  html += '</div>';
  document.getElementById('mainContainer').innerHTML = html;
}

function selectBookmarkGroup(group) {
  currentBookmarkGroup = group;
  loadContents();
}

function showStats() {
  const stats = [];
  BOOKS.forEach(book => {
    const bookContents = CONTENTS.filter(c => c.book === book.id);
    let todayCount = 0;
    let weekCount = 0;
    bookContents.forEach(content => {
      if (storage.isReadToday(content.book, content.chapter, content.verse)) todayCount++;
      if (storage.isReadThisWeek(content.book, content.chapter, content.verse)) weekCount++;
    });
    stats.push({
      bookName: book.name,
      total: bookContents.length,
      today: todayCount,
      week: weekCount
    });
  });
  
  let html = '<div class="page-container"><h2 style="margin-bottom:20px">í†µê³„</h2><table class="stats-table"><thead><tr><th>ì±…</th><th>ì „ì²´</th><th>ì˜¤ëŠ˜</th><th>ì´ë²ˆì£¼</th></tr></thead><tbody>';
  stats.forEach(stat => {
    html += `<tr><td>${stat.bookName}</td><td>${stat.total}</td><td>${stat.today}</td><td>${stat.week}</td></tr>`;
  });
  html += '</tbody></table></div>';
  document.getElementById('mainContainer').innerHTML = html;
}

function onBookFilterChange() {
  currentBookFilter = document.getElementById('bookSelector').value;
  currentIndex = 0;
  loadContents();
}

function exportLocalStorage() {
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    data[key] = localStorage.getItem(key);
  }
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `flashcard_data_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function importLocalStorage() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const data = JSON.parse(event.target.result);
        Object.keys(data).forEach(key => {
          localStorage.setItem(key, data[key]);
        });
        alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤');
        loadContents();
      } catch (err) {
        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

function showImportPage() {
  toggleSidebar();
  const html = `
    <div class="page-container">
      <h2 style="margin-bottom:20px">Content/Book ê°€ì ¸ì˜¤ê¸°</h2>
      <div class="import-section">
        <label class="import-label">Content JSON íŒŒì¼</label>
        <input type="file" id="contentFile" accept=".json">
        <button class="modal-btn primary" onclick="importContent()" style="width:100%;margin-top:10px">Content ê°€ì ¸ì˜¤ê¸°</button>
      </div>
      <div class="import-section">
        <label class="import-label">Book JSON íŒŒì¼</label>
        <input type="file" id="bookFile" accept=".json">
        <button class="modal-btn primary" onclick="importBook()" style="width:100%;margin-top:10px">Book ê°€ì ¸ì˜¤ê¸°</button>
      </div>
    </div>
  `;
  document.getElementById('mainContainer').innerHTML = html;
}

function importContent() {
  const file = document.getElementById('contentFile').files[0];
  if (!file) {
    alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      CONTENTS = data;
      alert('Contentë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤');
      updateBookSelector();
      currentMode = 'all';
      currentIndex = 0;
      loadContents();
    } catch (err) {
      alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    }
  };
  reader.readAsText(file);
}

function importBook() {
  const file = document.getElementById('bookFile').files[0];
  if (!file) {
    alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      BOOKS.length = 0;
      BOOKS.push(...data);
      alert('Bookì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤');
      updateBookSelector();
    } catch (err) {
      alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    }
  };
  reader.readAsText(file);
}

function updateBookSelector() {
  const selector = document.getElementById('bookSelector');
  selector.innerHTML = '<option value="">ì „ì²´</option>';
  BOOKS.forEach(book => {
    const option = document.createElement('option');
    option.value = book.id;
    option.textContent = book.name;
    selector.appendChild(option);
  });
}

// Initialize
updateBookSelector();
if (CONTENTS.length > 0) {
  loadContents();
}
</script>
</body>
</html>
